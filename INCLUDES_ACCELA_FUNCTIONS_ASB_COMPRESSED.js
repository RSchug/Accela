/*------------------------------------------------------------------------------------------------------/
| Program : INCLUDES_ACCELA_FUNCTIONS_ASB.js
| Event   : N/A
|
| Usage   : Accela Inc. Developed Master Script Functions.  This file should not be modified.  For custom
			includes make additions and overrides to the INCLUDES_CUSTOM script file.
|
| Notes   : For Application Submit Before see INCLUDES_ACCELA_FUNCTIONS_ASB
|
/------------------------------------------------------------------------------------------------------*/

var INCLUDE_VERSION = "3.2.1";

function getContactArrayBefore(){var e=aa.env.getValue("ContactList"),t=e.toArray(),r=new Array;if(t)for(yy in t){var a=new Array;a.lastName=t[yy].getPeople().lastName,a.refSeqNumber=t[yy].getRefContactNumber(),a.firstName=t[yy].getPeople().firstName,a.middleName=t[yy].getPeople().middleName,a.businessName=t[yy].getPeople().businessName,a.contactSeqNumber=t[yy].getPeople().contactSeqNumber,a.contactType=t[yy].getPeople().contactType,a.relation=t[yy].getPeople().relation,a.phone1=t[yy].getPeople().phone1,a.phone2=t[yy].getPeople().phone2,a.email=t[yy].getPeople().email,a.addressLine1=t[yy].getPeople().getCompactAddress().getAddressLine1(),a.addressLine2=t[yy].getPeople().getCompactAddress().getAddressLine2(),a.city=t[yy].getPeople().getCompactAddress().getCity(),a.state=t[yy].getPeople().getCompactAddress().getState(),a.zip=t[yy].getPeople().getCompactAddress().getZip(),a.fax=t[yy].getPeople().fax,a.notes=t[yy].getPeople().notes,a.country=t[yy].getPeople().getCompactAddress().getCountry(),a.fullName=t[yy].getPeople().fullName;var s=t[yy].getPeople().getAttributes().toArray();for(xx1 in s)a[s[xx1].attributeName]=s[xx1].attributeValue;r.push(a)}return r}function getCSLBInfoBefore(){var e=aa.env.getValue("CAEValidatedNumber");if(""==e||null==e)return!0;var t=aa.util.httpPost("http://www2.cslb.ca.gov/IVR/License+Detail.asp?LicNum="+e,"");if(!t.getSuccess())return logDebug("**ERROR: communicating with CSLB: "+t.getErrorMessage()),!1;var r=t.getOutput();if(r.indexOf("<Error>")>0)return logDebug("**ERROR: CSLB information returned an error: "+getNode(getNode(r,"License"),"**ERROR")),!1;var a=getNode(r,"BusinessInfo"),s=(getNode(r,"PrimaryStatus"),getNode(r,"Classifications"),getNode(r,"ContractorBond"),getNode(r,"WorkersComp"),new Date(getNode(a,"ExpireDt")));s<startDate&&(showMessage=!0,comment("**WARNING: Professional License expired on "+s.toString()))}function getGISBufferInfo(e,t,r){var a="feet",s=new Array,i=aa.gis.getGISType(e,t);if(!i.getSuccess())return logDebug("**ERROR: Getting GIS Type for Buffer Target.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage()),!1;var o=i.getOutput();for(argnum=3;argnum<arguments.length;argnum++)o.addAttributeName(arguments[argnum]);var g=aa.gis.getParcelGISObjects(ParcelValidatedNumber);if(!g.getSuccess())return logDebug("**ERROR: Getting GIS objects for Parcel.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var u=g.getOutput();for(a1 in u){var l=aa.gis.getBufferByRadius(u[a1],r,a,o);if(!l.getSuccess())return aa.print("**ERROR: Retrieving Buffer Check Results.  Reason is: "+l.getErrorType()+":"+l.getErrorMessage()),!1;var n=l.getOutput();for(a2 in n){var c=n[a2].getGISObjects();for(z1 in c){var p=c[z1].getAttributeNames(),f=c[z1].getAttributeValues(),d=new Array;d.GIS_ID=c[z1].getGisId();for(n1 in p)d[p[n1]]=f[n1];s.push(d)}}}return s}function getGISInfo(e,t,r){var a,s="feet",i=aa.gis.getGISType(e,t);if(!i.getSuccess())return logDebug("**ERROR: Getting GIS Type for Buffer Target.  Reason is: "+i.getErrorType()+":"+i.getErrorMessage()),!1;var o=i.getOutput();o.addAttributeName(r);var g=aa.gis.getParcelGISObjects(ParcelValidatedNumber);if(!g.getSuccess())return logDebug("**ERROR: Getting GIS objects for Parcel.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var u=g.getOutput();for(a1 in u){var l=aa.gis.getBufferByRadius(u[a1],"0",s,o);if(!l.getSuccess())return logDebug("**ERROR: Retrieving Buffer Check Results.  Reason is: "+l.getErrorType()+":"+l.getErrorMessage()),!1;var n=l.getOutput();for(a2 in n){var c=n[a2].getGISObjects();for(z1 in c){var p=c[z1].getAttributeValues();a=p[0]}}}return a}function getRelatedCapsByAddressBefore(e){var t=new Array;if(AddressValidatedNumber>0&&(addObj=aa.address.getRefAddressByPK(parseInt(AddressValidatedNumber)).getOutput(),AddressStreetName=addObj.getStreetName(),AddressHouseNumber=addObj.getHouseNumberStart(),AddressStreetSuffix=addObj.getStreetSuffix(),AddressZip=addObj.getZip(),AddressStreetDirection=addObj.getStreetDirection()),""==AddressStreetDirection&&(AddressStreetDirection=null),""==AddressHouseNumber&&(AddressHouseNumber=0),""==AddressStreetSuffix&&(AddressStreetSuffix=null),""==AddressZip&&(AddressZip=null),capAddResult=aa.cap.getCapListByDetailAddress(AddressStreetName,parseInt(AddressHouseNumber),AddressStreetSuffix,AddressZip,AddressStreetDirection,null),!capAddResult.getSuccess())return logDebug("**ERROR: getting similar addresses: "+capAddResult.getErrorMessage()),!1;var r=capAddResult.getOutput();for(cappy in r){relcap=aa.cap.getCap(r[cappy].getCapID()).getOutput(),reltype=relcap.getCapType().toString();var a=!0,s=e.split("/");if(4!=s.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in s)s[xx].equals(appTypeArray[xx])||s[xx].equals("*")||(a=!1);a&&t.push(r[cappy])}return t.length>0?t:void 0}function getRelatedCapsByParcelBefore(e){var t=new Array,r=aa.cap.getCapListByParcelID(ParcelValidatedNumber,null);if(!r.getSuccess())return logDebug("**ERROR: getting similar parcels: "+r.getErrorMessage()),!1;var a=r.getOutput();for(cappy in a){var s=aa.cap.getCap(a[cappy].getCapID()).getOutput(),i=s.getCapType().toString().split("/"),o=!0,g=e.split("/");if(4!=g.length)logDebug("**ERROR: The following Application Type String is incorrectly formatted: "+e);else for(xx in g)g[xx].equals(i[xx])||g[xx].equals("*")||(o=!1);o&&t.push(a[cappy])}return t.length>0?t:void 0}function loadAppSpecificBefore(e){for(loopk in AppSpecificInfoModels)useAppSpecificGroupName?(e[AppSpecificInfoModels[loopk].getCheckboxType()+"."+AppSpecificInfoModels[loopk].checkboxDesc]=AppSpecificInfoModels[loopk].checklistComment,logDebug("{"+AppSpecificInfoModels[loopk].getCheckboxType()+"."+AppSpecificInfoModels[loopk].checkboxDesc+"} = "+AppSpecificInfoModels[loopk].checklistComment)):(e[AppSpecificInfoModels[loopk].checkboxDesc]=AppSpecificInfoModels[loopk].checklistComment,logDebug("{"+AppSpecificInfoModels[loopk].checkboxDesc+"} = "+AppSpecificInfoModels[loopk].checklistComment))}function loadASITablesBefore(){for(var gm=aa.env.getValue("AppSpecificTableGroupModel"),ta=gm.getTablesMap().values(),tai=ta.iterator();tai.hasNext();){var tsm=tai.next();if(!tsm.rowIndex.isEmpty()){var tempObject=new Array,tempArray=new Array,tn=tsm.getTableName();tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn);for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next();tempObject[tcol.getColumnName()]=tval}tempArray.push(tempObject);var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}}function loadASITables(){for(var gm=aa.env.getValue("AppSpecificTableGroupModel"),ta=gm.getTablesMap().values(),tai=ta.iterator();tai.hasNext();){var tsm=tai.next();if(!tsm.rowIndex.isEmpty()){var tempObject=new Array,tempArray=new Array,tn=tsm.getTableName();tn=String(tn).replace(/[^a-zA-Z0-9]+/g,""),isNaN(tn.substring(0,1))||(tn="TBL"+tn);for(var tsmfldi=tsm.getTableField().iterator(),tsmcoli=tsm.getColumns().iterator(),numrows=1;tsmfldi.hasNext();){if(!tsmcoli.hasNext()){var tsmcoli=tsm.getColumns().iterator();tempArray.push(tempObject);var tempObject=new Array;numrows++}var tcol=tsmcoli.next(),tval=tsmfldi.next();tempObject[tcol.getColumnName()]=tval}tempArray.push(tempObject);var copyStr=""+tn+" = tempArray";logDebug("ASI Table Array : "+tn+" ("+numrows+" Rows)"),eval(copyStr)}}}function loadParcelAttributes(e){var t=capId;2==arguments.length&&(t=arguments[1]);var r=null,a=aa.parcel.getParcelandAttribute(t,null);if(a.getSuccess())var r=a.getOutput().toArray();else logDebug("**ERROR: Failed to get Parcel object: "+a.getErrorType()+":"+a.getErrorMessage());for(i in r){parcelArea+=r[i].getParcelArea(),parcelAttrObj=r[i].getParcelAttribute().toArray();for(z in parcelAttrObj)e["ParcelAttribute."+parcelAttrObj[z].getB1AttributeName()]=parcelAttrObj[z].getB1AttributeValue();e["ParcelAttribute.Block"]=r[i].getBlock(),e["ParcelAttribute.Book"]=r[i].getBook(),e["ParcelAttribute.CensusTract"]=r[i].getCensusTract(),e["ParcelAttribute.CouncilDistrict"]=r[i].getCouncilDistrict(),e["ParcelAttribute.ExemptValue"]=r[i].getExemptValue(),e["ParcelAttribute.ImprovedValue"]=r[i].getImprovedValue(),e["ParcelAttribute.InspectionDistrict"]=r[i].getInspectionDistrict(),e["ParcelAttribute.LandValue"]=r[i].getLandValue(),e["ParcelAttribute.LegalDesc"]=r[i].getLegalDesc(),e["ParcelAttribute.Lot"]=r[i].getLot(),e["ParcelAttribute.MapNo"]=r[i].getMapNo(),e["ParcelAttribute.MapRef"]=r[i].getMapRef(),e["ParcelAttribute.ParcelStatus"]=r[i].getParcelStatus(),e["ParcelAttribute.SupervisorDistrict"]=r[i].getSupervisorDistrict(),e["ParcelAttribute.Tract"]=r[i].getTract(),e["ParcelAttribute.PlanArea"]=r[i].getPlanArea()}}function proximity(e,t,r){var a="feet";if(4==arguments.length&&(a=arguments[3]),bufferTargetResult=aa.gis.getGISType(e,t),!bufferTargetResult.getSuccess())return logDebug("**ERROR: Getting GIS Type for Buffer Target.  Reason is: "+bufferTargetResult.getErrorType()+":"+bufferTargetResult.getErrorMessage()),!1;buf=bufferTargetResult.getOutput(),buf.addAttributeName(t+"_ID");var s=aa.gis.getParcelGISObjects(ParcelValidatedNumber);if(!s.getSuccess())return logDebug("**ERROR: Getting GIS objects for Parcel.  Reason is: "+s.getErrorType()+":"+s.getErrorMessage()),!1;var i=s.getOutput();for(a1 in i){var o=aa.gis.getBufferByRadius(i[a1],r,a,buf);if(!o.getSuccess())return logDebug("**ERROR: Retrieving Buffer Check Results.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage()),!1;var g=o.getOutput();for(a2 in g)if(proxObj=g[a2].getGISObjects(),proxObj.length)return!0}}function proximityToAttribute(e,t,r,a,s,i){var o=aa.gis.getGISType(e,t);if(!o.getSuccess())return logDebug("**ERROR: Getting GIS Type for Buffer Target.  Reason is: "+o.getErrorType()+":"+o.getErrorMessage()),!1;buf=o.getOutput(),buf.addAttributeName(s);var g=aa.gis.getParcelGISObjects(ParcelValidatedNumber);if(!g.getSuccess())return logDebug("**ERROR: Getting GIS objects for Parcel.  Reason is: "+g.getErrorType()+":"+g.getErrorMessage()),!1;var u=g.getOutput();for(a1 in u){var l=aa.gis.getBufferByRadius(u[a1],r,a,buf);if(!l.getSuccess())return logDebug("**ERROR: Retrieving Buffer Check Results.  Reason is: "+l.getErrorType()+":"+l.getErrorMessage()),!1;var n=l.getOutput();for(a2 in n){var c=n[a2].getGISObjects();for(z1 in c){var p=c[z1].getAttributeValues();if(retString=p[0],retString&&retString.equals(i))return!0}}}}

 
